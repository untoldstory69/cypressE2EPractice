version: "2.1"
orbs:
  cypress: cypress-io/cypress@3
workflows:
  use-my-orb:
    jobs:
      - cypress/run:
          cypress-cache-key: custom-cypress-cache-v1-{{ arch }}-{{ checksum "package.json" }}
          cypress-cache-path: ~/.cache/custom-dir/Cypress
          cypress-command: npm run test:generatereport 
          node-cache-version: v2

      steps:
        - when:
            condition: << parameters.start-command >>
            steps:
              - run:
                  background: true
                  command: << parameters.start-command >>
                  name: Start Server
                  working_directory: << parameters.working-directory >>
        - run:
            command: << parameters.cypress-command >>
            name: Run Cypress
            working_directory: << parameters.working-directory >>
        - store_artifacts:
            path: << parameters.working-directory >>/cypress/videos
        - store_artifacts:
            path: << parameters.working-directory >>/cypress/screenshots